
<!DOCTYPE HTML>
<html lang="" >
    <head>
        <meta charset="UTF-8">
        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <title>Golang Â· OpenStorage API</title>
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="description" content="">
        <meta name="generator" content="GitBook 3.2.3">
        
        
        
    
    <link rel="stylesheet" href="gitbook/style.css">

    
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-codetabs/codetabs.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-toggle-chapters/toggle.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-prism/prism.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-page-toc/page-toc.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-search/search.css">
                
            
                
                <link rel="stylesheet" href="gitbook/gitbook-plugin-fontsettings/website.css">
                
            
        

    

    
        
    
        
    
        
    
        
    
        
    
        
    

        
    
    
    <meta name="HandheldFriendly" content="true"/>
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon-precomposed" sizes="152x152" href="gitbook/images/apple-touch-icon-precomposed-152.png">
    <link rel="shortcut icon" href="gitbook/images/favicon.ico" type="image/x-icon">

    
    <link rel="next" href="tutorial-python.html" />
    
    
    <link rel="prev" href="tutorial.html" />
    

    </head>
    <body>
        
<div class="book">
    <div class="book-summary">
        
            
<div id="book-search-input" role="search">
    <input type="text" placeholder="Type to search" />
</div>

            
                <nav role="navigation">
                


<ul class="summary">
    
    

    

    
        
        <li class="header">OpenStorage SDK</li>
        
        
    
        <li class="chapter " data-level="1.1" data-path="./">
            
                <a href="./">
            
                    
                        <b>1.1.</b>
                    
                    Introduction
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.2" data-path="status.html">
            
                <a href="status.html">
            
                    
                        <b>1.2.</b>
                    
                    Status
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.3" data-path="arch.html">
            
                <a href="arch.html">
            
                    
                        <b>1.3.</b>
                    
                    Architecture
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.4" data-path="installation.html">
            
                <a href="installation.html">
            
                    
                        <b>1.4.</b>
                    
                    Installation
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5" data-path="tutorial.html">
            
                <a href="tutorial.html">
            
                    
                        <b>1.5.</b>
                    
                    Tutorial
            
                </a>
            

            
            <ul class="articles">
                
    
        <li class="chapter active" data-level="1.5.1" data-path="tutorial-golang.html">
            
                <a href="tutorial-golang.html">
            
                    
                        <b>1.5.1.</b>
                    
                    Golang
            
                </a>
            

            
        </li>
    
        <li class="chapter " data-level="1.5.2" data-path="tutorial-python.html">
            
                <a href="tutorial-python.html">
            
                    
                        <b>1.5.2.</b>
                    
                    Python
            
                </a>
            

            
        </li>
    

            </ul>
            
        </li>
    
        <li class="chapter " data-level="1.6" data-path="generated-api.html">
            
                <a href="generated-api.html">
            
                    
                        <b>1.6.</b>
                    
                    API Reference
            
                </a>
            

            
        </li>
    

    

    <li class="divider"></li>

    <li>
        <a href="https://www.gitbook.com" target="blank" class="gitbook-link">
            Published with GitBook
        </a>
    </li>
</ul>


                </nav>
            
        
    </div>

    <div class="book-body">
        
            <div class="body-inner">
                
                    

<div class="book-header" role="navigation">
    

    <!-- Title -->
    <h1>
        <i class="fa fa-circle-o-notch fa-spin"></i>
        <a href="." >Golang</a>
    </h1>
</div>




                    <div class="page-wrapper" tabindex="-1" role="main">
                        <div class="page-inner">
                            
<div id="book-search-results">
    <div class="search-noresults">
    
                                <section class="normal markdown-section">
                                
                                <h1 id="tutorial-golang">Tutorial: Golang</h1>
<p>In this tutorial you will learn to setup your environment, create a volume,
then take its snapshot.</p>
<h2 id="setting-up-your-environment">Setting up your environment</h2>
<p>To setup your environment, you will need to import the following to gain
access to <code>api.pb.go</code>:</p>
<pre class="language-"><code class="lang-go"><span class="token keyword">import</span> <span class="token punctuation">(</span>
    <span class="token string">&quot;github.com/libopenstorage/openstorage/api&quot;</span>

    <span class="token string">&quot;google.golang.org/grpc&quot;</span>
    <span class="token string">&quot;google.golang.org/grpc/status&quot;</span>
<span class="token punctuation">)</span>
</code></pre>
<p>Once you have imported this library into your project, you will have access
to the OpenStorage SDK Golang client which was generated from the protobuf
file <a href="https://github.com/libopenstorage/openstorage/blob/master/api/api.proto" target="_blank"><code>api.proto</code></a>.</p>
<p>With the <a href="tutorial.html#setting-up-the-mock-sdk-server"><code>mock-sdk-server</code></a>
running, the following steps will provide an introduction to programming
with the OpenStorage SDK.</p>
<h2 id="creating-a-connection">Creating a connection</h2>
<p>To use any of the gRPC functions, you must first create a connection with
the OpenStorage SDK server:</p>
<pre class="language-"><code class="lang-go">    <span class="token comment" spellcheck="true">// Setup a connection</span>
    conn<span class="token punctuation">,</span> err <span class="token operator">:=</span> grpc<span class="token punctuation">.</span><span class="token function">Dial</span><span class="token punctuation">(</span><span class="token string">&quot;:9100&quot;</span><span class="token punctuation">,</span> grpc<span class="token punctuation">.</span><span class="token function">WithInsecure</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error: %v&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
</code></pre>
<h2 id="cluster-operations">Cluster operations</h2>
<p>Now that we have made a connection, we can use the <code>conn</code> object to create
clients for each of the services we would like to use. Let&apos;s use the <a href="generated-api.html#openstorageapiopenstoragecluster">OpenStorageCluster</a>
service to print the <code>id</code> of the cluster and how many nodes it has:</p>
<pre class="language-"><code class="lang-go">    <span class="token comment" spellcheck="true">// Create a cluster client</span>
    cluster <span class="token operator">:=</span> api<span class="token punctuation">.</span><span class="token function">NewOpenStorageClusterClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>

    <span class="token comment" spellcheck="true">// Print the cluster information</span>
    clusterEnum<span class="token punctuation">,</span> err <span class="token operator">:=</span> cluster<span class="token punctuation">.</span><span class="token function">Enumerate</span><span class="token punctuation">(</span>
        context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>api<span class="token punctuation">.</span>SdkClusterEnumerateRequest<span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        gerr<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> status<span class="token punctuation">.</span><span class="token function">FromError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error Code[%d] Message[%s]\n&quot;</span><span class="token punctuation">,</span>
            gerr<span class="token punctuation">.</span><span class="token function">Code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gerr<span class="token punctuation">.</span><span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Connected to Cluster %s with %d node(s)\n&quot;</span><span class="token punctuation">,</span>
        clusterEnum<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token function">len</span><span class="token punctuation">(</span>clusterEnum<span class="token punctuation">.</span><span class="token function">GetCluster</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">GetNodeIds</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Notice the <code>status.FromError()</code> call above. As mentioned in the
<a href="arch.html#error-handling">Architecture</a> all errors are encoded the standard
gRPC status. To gain access to the error code and its message you must
use <code>status.FromError()</code> which decodes the error value and the message.</p>
<p>Notice also the use of accessors <code>GetXXX()</code> above. These convenient functions
are provided automatically be the golang protobuf generator.</p>
<h2 id="volume-operations">Volume Operations</h2>
<p>Now that we have connected to the cluster, let&apos;s go ahead and create a
volume of size 100Gi:</p>
<pre class="language-"><code class="lang-go">    <span class="token comment" spellcheck="true">// Create a 100Gi volume</span>
    volumes <span class="token operator">:=</span> api<span class="token punctuation">.</span><span class="token function">NewOpenStorageVolumeClient</span><span class="token punctuation">(</span>conn<span class="token punctuation">)</span>
    v<span class="token punctuation">,</span> err <span class="token operator">:=</span> volumes<span class="token punctuation">.</span><span class="token function">Create</span><span class="token punctuation">(</span>
        context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>api<span class="token punctuation">.</span>SdkVolumeCreateRequest<span class="token punctuation">{</span>
            Name<span class="token punctuation">:</span> <span class="token string">&quot;myvol&quot;</span><span class="token punctuation">,</span>
            Spec<span class="token punctuation">:</span> <span class="token operator">&amp;</span>api<span class="token punctuation">.</span>VolumeSpec<span class="token punctuation">{</span>
                Size<span class="token punctuation">:</span> <span class="token number">100</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span> <span class="token operator">*</span> <span class="token number">1024</span><span class="token punctuation">,</span>
            <span class="token punctuation">}</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        gerr<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> status<span class="token punctuation">.</span><span class="token function">FromError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error Code[%d] Message[%s]\n&quot;</span><span class="token punctuation">,</span>
            gerr<span class="token punctuation">.</span><span class="token function">Code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gerr<span class="token punctuation">.</span><span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Volume 100Gi created with id %s\n&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">.</span><span class="token function">GetVolumeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>Notice the value of <code>Name</code> provided above. This value is important since
it allows for the function to be idempotent. In other words, this function
will always return the same volume id for the volume of same name.</p>
<p>You can now create a snapshot of this volume:</p>
<pre class="language-"><code class="lang-go">    snap<span class="token punctuation">,</span> err <span class="token operator">:=</span> volumes<span class="token punctuation">.</span><span class="token function">SnapshotCreate</span><span class="token punctuation">(</span>
        context<span class="token punctuation">.</span><span class="token function">Background</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token operator">&amp;</span>api<span class="token punctuation">.</span>SdkVolumeSnapshotCreateRequest<span class="token punctuation">{</span>
            VolumeId<span class="token punctuation">:</span> v<span class="token punctuation">.</span><span class="token function">GetVolumeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
        gerr<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> status<span class="token punctuation">.</span><span class="token function">FromError</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
        fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Error Code[%d] Message[%s]\n&quot;</span><span class="token punctuation">,</span>
            gerr<span class="token punctuation">.</span><span class="token function">Code</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span> gerr<span class="token punctuation">.</span><span class="token function">Message</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
        os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
    fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Snapshot with id %s was create for volume %s\n&quot;</span><span class="token punctuation">,</span>
        snap<span class="token punctuation">.</span><span class="token function">GetSnapshotId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        v<span class="token punctuation">.</span><span class="token function">GetVolumeId</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre>
<p>As you can see from the above, working with OpenStorage SDK is quite easy,
fun, and powerful. Please refer to the <a href="generated-api.html">API Reference</a>
for a complete list of services.</p>

                                
                                </section>
                            
    </div>
    <div class="search-results">
        <div class="has-results">
            
            <h1 class="search-results-title"><span class='search-results-count'></span> results matching "<span class='search-query'></span>"</h1>
            <ul class="search-results-list"></ul>
            
        </div>
        <div class="no-results">
            
            <h1 class="search-results-title">No results matching "<span class='search-query'></span>"</h1>
            
        </div>
    </div>
</div>

                        </div>
                    </div>
                
            </div>

            
                
                <a href="tutorial.html" class="navigation navigation-prev " aria-label="Previous page: Tutorial">
                    <i class="fa fa-angle-left"></i>
                </a>
                
                
                <a href="tutorial-python.html" class="navigation navigation-next " aria-label="Next page: Python">
                    <i class="fa fa-angle-right"></i>
                </a>
                
            
        
    </div>

    <script>
        var gitbook = gitbook || [];
        gitbook.push(function() {
            gitbook.page.hasChanged({"page":{"title":"Golang","level":"1.5.1","depth":2,"next":{"title":"Python","level":"1.5.2","depth":2,"path":"tutorial-python.md","ref":"tutorial-python.md","articles":[]},"previous":{"title":"Tutorial","level":"1.5","depth":1,"path":"tutorial.md","ref":"tutorial.md","articles":[{"title":"Golang","level":"1.5.1","depth":2,"path":"tutorial-golang.md","ref":"tutorial-golang.md","articles":[]},{"title":"Python","level":"1.5.2","depth":2,"path":"tutorial-python.md","ref":"tutorial-python.md","articles":[]}]},"dir":"ltr"},"config":{"plugins":["codetabs","toggle-chapters","toggle-headers","edit-link","prism","github","page-toc","-highlight","-sharing"],"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"pluginsConfig":{"prism":{},"github":{"url":"https://github.com/libopenstorage/openstorage/"},"search":{},"page-toc":{"position":"top","selector":".markdown-section h1, .markdown-section h2","showByDefault":false},"codetabs":{},"lunr":{"maxIndexSize":1000000,"ignoreSpecialCharacters":false},"toggle-headers":{},"fontsettings":{"theme":"white","family":"sans","size":2},"edit-link":{"label":"Edit this page","base":"https://github.com/libopenstorage/libopenstorage.github.io/tree/master/docs"},"theme-default":{"styles":{"website":"styles/website.css","pdf":"styles/pdf.css","epub":"styles/epub.css","mobi":"styles/mobi.css","ebook":"styles/ebook.css","print":"styles/print.css"},"showLevel":true},"toggle-chapters":{}},"theme":"default","pdf":{"pageNumbers":true,"fontSize":12,"fontFamily":"Arial","paperSize":"a4","chapterMark":"pagebreak","pageBreaksBefore":"/","margin":{"right":62,"left":62,"top":56,"bottom":56}},"structure":{"langs":"LANGS.md","readme":"README.md","glossary":"GLOSSARY.md","summary":"SUMMARY.md"},"variables":{},"title":"OpenStorage API","gitbook":">=3.2.1"},"file":{"path":"tutorial-golang.md","mtime":"2018-07-09T21:42:17.066Z","type":"markdown"},"gitbook":{"version":"3.2.3","time":"2018-07-09T21:47:30.152Z"},"basePath":".","book":{"language":""}});
        });
    </script>
</div>

        
    <script src="gitbook/gitbook.js"></script>
    <script src="gitbook/theme.js"></script>
    
        
        <script src="gitbook/gitbook-plugin-codetabs/codetabs.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-toggle-chapters/toggle.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-toggle-headers/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-edit-link/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-github/plugin.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-page-toc/anchor-3.1.1.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-page-toc/page-toc.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search-engine.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-search/search.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/lunr.min.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-lunr/search-lunr.js"></script>
        
    
        
        <script src="gitbook/gitbook-plugin-fontsettings/fontsettings.js"></script>
        
    

    </body>
</html>

